var m=(r,e,t)=>new Promise((s,o)=>{var i=l=>{try{h(t.next(l))}catch(c){o(c)}},a=l=>{try{h(t.throw(l))}catch(c){o(c)}},h=l=>l.done?s(l.value):Promise.resolve(l.value).then(i,a);h((t=t.apply(r,e)).next())});import{c as n,i as u}from"./bundle.DSLTpUOX.js";class d{getItem(e){let t=`${n.prefix}${e}`;return localStorage.getItem(t)}setItem(e,t){let s=`${n.prefix}${e}`;localStorage.setItem(s,t)}initItem(e,t){let s=`${n.prefix}${e}`,o=localStorage.getItem(s);return o===null?(localStorage.setItem(s,t),localStorage.getItem(s)):o}}class g{constructor(){this.lock=n.lockOrientation,!(!this.lock||!u({tablet:!0}))&&this.init()}init(){let e=`url(images/web/play_${this.lock}.png)`,t=document.getElementById("turn");t.style.backgroundImage=e,this.isCorrect?window.onresize=()=>{let s=this.isCorrect?"none":"block";t.style.display=s}:(t.style.display="block",window.onresize=()=>{this.isCorrect&&window.location.reload()})}get isCorrect(){return window.innerWidth>window.innerHeight?this.lock==="landscape":this.lock==="portrait"}}class p{constructor(e){this.scene=e,this.storage=e.game.storage,this.tracks=null,this.audio={},this.volume={}}setVolume(e,t){this.volume[e]=t,this.audio[e].forEach(s=>s.setVolume(t)),this.storage.setItem(`volume_${e}`,t)}getVolume(e){return parseFloat(this.volume[e])}flipVolume(e){let t=this.getVolume(e),s=n[`${e}MaxVolume`],o=t===0?s:0;return this.setVolume(e,o),parseFloat(o)}load(e,t){this.scene=e,this.tracks=t;let s="audio",o=[".ogg",".m4a",".mp3",".ac3"];this.scene.load.setPath(s),t.forEach(i=>{this.audio[i]=[];let a=o.map(h=>`${i}${h}?${Date.now()}`);this.scene.load.audioSprite(i,`${i}.json`,a)}),this.scene.load.setPath(""),this.tracks.forEach(i=>{let a=this.storage.initItem(`volume_${i}`,n[`${i}MaxVolume`]);this.volume[i]=a})}play(e,t,s={}){let o=this.scene.sound.addAudioSprite(e);return o.track=e,this.audio[e].push(o),o.once("complete",()=>this.remove(o)),s.volume=this.volume[e],o.play(t,s),o}remove(e){let t=this.audio[e.track].indexOf(e);this.audio[e.track].splice(t,1),e.isPlaying&&e.destroy()}}class f{constructor(e){this.scene=e}randomRange(e,t){return Math.random()*(t-e)+e}wait(e){return new Promise(t=>{this.activeScene.time.addEvent({delay:e,callback:()=>t()})})}get activeScene(){return this.scene.scene.manager.getScenes(!0)[0]}}class w{constructor(){this.listeners=[]}addListener(e,t,s,o){if(typeof t!="function")throw new TypeError("The listener must be a function");this.listeners.find(a=>a.event===e&&a.fn===t&&a.context===s)||this.listeners.push({event:e,fn:t,context:s,once:o})}removeListener(e,t,s){this.listeners.filter(i=>i.event===e&&i.fn===t&&i.context===s).forEach(i=>{let a=this.listeners.indexOf(i);this.listeners.splice(a,1)})}on(e,t,s){this.addListener(e,t,s,!1)}once(e,t,s){this.addListener(e,t,s,!0)}off(e,t,s){this.removeListener(e,t,s)}emit(e,...t){return m(this,null,function*(){let s=[],o=this.listeners.filter(i=>i.event===e);return o.forEach(i=>s.push(i.fn.call(i.context,...t))),yield Promise.all(s),o.forEach(i=>{i.once&&this.removeListener(i.event,i.fn,i.context)}),new Promise(i=>i())})}}class S extends Phaser.Scene{constructor(e){super(e)}preload(){this.load.image("preload_logo","images/preload/logo.png"),this.load.image("preload_bar","images/preload/bar.png")}create(){this.game.scale.scaleMode===Phaser.Scale.ScaleModes.NONE?this.scale.resize(this.cameras.main.width,this.cameras.main.height):this.scale.setGameSize(this.cameras.main.width,this.cameras.main.height),this.game.storage=new d,this.game.orientation=new g,this.game.audio=new p(this),this.game.utils=new f(this),this.game.pevents=new w,this.scene.start("Preload")}}export{S as default};
